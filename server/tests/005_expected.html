<div><p>One of the first XKCD comics to go viral was this one,
<a href="https://xkcd.com/303/" title="null" rel="noopener noreferrer">#303</a>:</p>
<p><a href="https://xkcd.com/303/" title="null" rel="noopener noreferrer"><img alt="XKCD comic where the developers are playing with swords since their code is compiling." title=""></a></p>
<p>Today, the web developer version would be "my site's building" and they would be
playing swords in VR.</p>
<p>Sites take time to build these days. A large Next.js 11 site will take several
minutes to build. This is wasted time in the development cycle. Build tools like
<a href="https://vitejs.dev/" title="null" rel="noopener noreferrer">Vite</a> or <a href="https://turbo.build/pack" title="null" rel="noopener noreferrer">Turbopack</a> highlight
their ability to get this number down.</p>
<p>But the deeper question hasn't been considered:</p>
<p><em>Why do we even need a build step?</em></p>
<h2>How building became the norm</h2><p>In simpler times, you added a few <code>&lt;script src="my_jquery_script.js"&gt;&lt;/script&gt;</code>
tags in your <code>index.html</code> and all was golden.</p>
<p>Then Node was created, allowing developers to write servers and backends in
JavaScript. Soon, developers no longer needed to know multiple languages to
build scalable, production-ready apps. They only needed to know JavaScript.</p>
<figure>
  <img alt="Interest in Node on Google over time">
  <figcaption>Interest in Node.js grew since its inception.</figcaption>
</figure>


<p>If we’d left it there, everything would be fine. But at some point, somebody
posed the dangerous question:</p>
<p><em>What if I could write server side JS but in the browser?</em></p>
<p>Node's server-side JavaScript isn't compatible with browser JavaScript, because
each implementation satisfies two entirely different systems:</p>
<ul>
<li><strong>Node is built around a filesystem.</strong> A server has HTTP-driven IO, but the
internals are all about finding the right files within the filesystem.</li>
<li><strong>JavaScript was created for browsers</strong> where scripts/resources are imported
asynchronously via URLs.</li>
</ul>
<p>Other key issues that drove the necessity of a build step include:</p>
<ol>
<li>The browser didn't have a "package manager", while npm was quickly becoming
the de facto package manager for Node and JavaScript-at-large. Frontend
developers wanted an easy way to manage JavaScript dependencies in the
browser.</li>
<li>npm modules, and the method of importing them (CommonJS), are not supported
in the browser.</li>
<li>Browser JavaScript continues to evolve (since 2009, it has added Promises,
<code>async</code>/<code>await</code>s, top-level <code>await</code>s, ES Modules, and classes) while Node's
JavaScript is a few cycles behind.</li>
<li>There are different flavors of JavaScript used on the server. CoffeeScript
brought Pythonic and Ruby-like styling to the language, JSX allowed writing
HTML markup, and Typescript enabled Type safety. But all these need to be
translated into regular JavaScript for the browser.</li>
<li>Node is modularized, so code from different npm modules need to be bundled
and minified to reduce the amount of code being shipped to the client.</li>
<li>Some features used in the original code might not be available to older
browsers, so
<a href="https://developer.mozilla.org/en-US/docs/Glossary/Polyfill" title="null" rel="noopener noreferrer">polyfills</a> need
to be added to bridge the gap.</li>
<li>CSS frameworks and preprocessors (such as <a href="https://lesscss.org/" title="null" rel="noopener noreferrer">LESS</a> and
<a href="https://sass-lang.com/" title="null" rel="noopener noreferrer">SASS</a>), which were created to improve the experience
of writing and maintaining complex CSS codebases, need to be transpiled into
vanilla, browser-parseable CSS.</li>
<li>Rendering dynamic data through HTML (á la static site generators) typically
requires a separate step before the HTML is deployed to a hosting provider.</li>
</ol>
<p>Over time, frameworks and metaframeworks improved developer experience by making
it easier to write and manage complex apps. But the trade off for better
developer experience was a more complex build step. For example, you could make
a zero build blog and write it in HTML. Or, you could write your blog in
markdown that will be rendered through HTML, which requires a build step.</p>
<p><img alt="Developer experience vs. build complexity chart" title=""></p>
<p>But not all build steps are meant to allow a good developer experience. Others
are to improve the performance for the end user (e.g. optimization steps such as
creating several image sizes and converting them to optimal formats).</p>
<p>All that to say, inevitably, a set of code transformations must be applied for
the code to run in the browser, which today we all know as... <strong>the build
step</strong>.</p>
<h2>The rise of JavaScript build tools</h2><p>To meet the growing interest of making server-side JavaScript work in the
browser, several open source build tools launched, marking the advent of the
"build tool ecosystem" of JavaScript.</p>
<p>In 2011, <a href="https://browserify.org/" title="null" rel="noopener noreferrer">Browserify</a> launched to bundle Node/npm for
the browser. Then came Gulp (2013) and other build tools, task runners, etc., to
manage the variety of build tasks needed to allow devs to keep writing Node but
for the browser. More and more build tools came onto the scene.</p>
<p>Here's a non-exhaustive list of build tools over time:</p>
<ul>
<li><a href="https://browserify.org/" title="null" rel="noopener noreferrer">Browserify</a> - 2011</li>
<li><a href="https://gruntjs.com/" title="null" rel="noopener noreferrer">Grunt</a> - 2012</li>
<li><a href="https://bower.io/" title="null" rel="noopener noreferrer">Bower</a> - 2012</li>
<li><a href="https://gulpjs.com/" title="null" rel="noopener noreferrer">Gulp</a> - 2013</li>
<li><a href="https://babeljs.io/" title="null" rel="noopener noreferrer">Babel</a> - 2014</li>
<li><a href="https://webpack.js.org/" title="null" rel="noopener noreferrer">Webpack</a> - 2014</li>
<li><a href="https://rollupjs.org/" title="null" rel="noopener noreferrer">Rollup</a> - 2015</li>
<li><a href="https://parceljs.org/" title="null" rel="noopener noreferrer">Parcel</a> - 2017</li>
<li><a href="https://swc.rs/" title="null" rel="noopener noreferrer">SWC</a> - 2019</li>
<li><a href="https://vitejs.dev/" title="null" rel="noopener noreferrer">Vite</a> - 2020</li>
<li><a href="https://esbuild.github.io/" title="null" rel="noopener noreferrer">ESBuild</a> - 2020</li>
<li><a href="https://turbo.build/pack" title="null" rel="noopener noreferrer">Turbopack</a> - 2022</li>
</ul>
<p>By 2020's, build tools have become their
<a href="https://stackshare.io/javascript-build-tools" title="null" rel="noopener noreferrer">own category of JS library/framework</a>.
Many of these tools also have their own ecosystem of plugins and loaders to
allow developers to use their favorite technologies.</p>
<p>For example, Webpack provides a variety of
<a href="https://webpack.js.org/awesome-webpack/#loaders" title="null" rel="noopener noreferrer">loaders</a> for SASS, Babel,
SVGs, and Bootstrap among many others. This allows developers to choose their
own build stack: they can have webpack as their module bundler, babel as their
TS transpiler, with a postcss loader for Tailwind.</p>
<p>Build steps are inevitable in modern web development. But before we can ask
whether build tools are even needed, let's first ask:</p>
<p><em>What exactly needs to happen to make server-side JavaScript run in the
browser?</em></p>
<h2>The Next.js Four-step Build Process</h2><p>Let’s take a look at a real-life example with Next.js. We won’t spool up their
basic app, instead we’ll use the
<a href="https://github.com/vercel/next.js/tree/canary/examples/blog-starter" title="null" rel="noopener noreferrer">blog starter</a>
as something you may well build with this framework:</p>
<div><pre>npx create-next-app <span>--example</span> blog-starter blog-starter-app</pre></div><p>Without changing anything, we’ll run:</p>
<p>This is going to kick off a 4-step process to get your Next.js project to run in
the browser:</p>
<ul>
<li><a title="null" rel="noopener noreferrer">Compiling</a></li>
<li><a title="null" rel="noopener noreferrer">Minifying</a></li>
<li><a title="null" rel="noopener noreferrer">Bundling</a></li>
<li><a title="null" rel="noopener noreferrer">Code splitting</a></li>
</ul>
<p>Each step in the build process is either to support developer experience in
writing code or to improve performance for the end user. Let's dive in.</p>
<h3>Compiling</h3><p>When you’re building a web app, your main focus is productivity and experience.
So you'll use a framework like Next.js, which means you’re likely also using
React, ESM modules, JSX, <code>async</code>/<code>await</code>, TypeScript, etc. But this code needs
to be converted into vanilla JavaScript for the browser, which occurs in the
compilation step:</p>
<ul>
<li>First, parse the code and turn it into an abstract representation, called an
<a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree" title="null" rel="noopener noreferrer">Abstract Syntax Tree</a></li>
<li>Then, transform this AST into a representation that is supported by the target
language</li>
<li>Finally, generate new code from this new AST representation</li>
</ul>
<p><em>If you want to learn more about the internals of compilers,
<a href="https://github.com/jamiebuilds/the-super-tiny-compiler" title="null" rel="noopener noreferrer">The Super Tiny Compiler</a>
is an excellent tutorial into how they work.</em></p>
<p>Next.js's first step is to compile all of your code to plain JavaScript. Let’s
take the Post function in <code>[slug].tsx</code> as an example:</p>
<div><pre><span>export</span> <span>default</span> <span>function</span> <span><span>Post</span></span><span>(</span><span><span>{</span> post<span>,</span> morePosts<span>,</span> preview <span>}</span><span>:</span> <span>Props</span></span><span>)</span> <span>{</span>
  <span>const</span> router <span>=</span> <span>useRouter</span><span>(</span><span>)</span>
  <span>if</span> <span>(</span><span>!</span>router<span>.</span><span>isFallback</span> <span>&amp;&amp;</span> <span>!</span>post<span>?.</span>slug<span>)</span> <span>{</span>
    <span>return</span> <span><span><span>&lt;</span><span>ErrorPage</span></span> <span>statusCode</span><span><span>=</span><span>{</span><span>404</span><span>}</span></span> <span>/&gt;</span></span>
  <span>}</span>
  <span>return</span> <span>(</span>
    <span><span><span>&lt;</span><span>Layout</span></span> <span>preview</span><span><span>=</span><span>{</span>preview<span>}</span></span><span>&gt;</span></span><span>
      </span><span><span><span>&lt;</span><span>Container</span></span><span>&gt;</span></span><span>
        </span><span><span><span>&lt;</span><span>Header</span></span> <span>/&gt;</span></span><span>
        </span><span>{</span>router<span>.</span><span>isFallback</span> <span>?</span> <span>(</span>
          <span><span><span>&lt;</span><span>PostTitle</span></span><span>&gt;</span></span><span>Loading…</span><span><span><span>&lt;/</span><span>PostTitle</span></span><span>&gt;</span></span>
        <span>)</span> <span>:</span> <span>(</span>
          <span><span><span>&lt;</span></span><span>&gt;</span></span><span>
            </span><span><span><span>&lt;</span>article</span> <span>className</span><span><span>=</span><span>"</span>mb-32<span>"</span></span><span>&gt;</span></span><span>
              </span><span><span><span>&lt;</span><span>Head</span></span><span>&gt;</span></span><span>
                </span><span><span><span>&lt;</span>title</span><span>&gt;</span></span><span>
                  </span><span>{</span>post<span>.</span><span>title</span><span>}</span><span> | Next.js Blog Example with </span><span>{</span><span>CMS_NAME</span><span>}</span><span>
                </span><span><span><span>&lt;/</span>title</span><span>&gt;</span></span><span>
                </span><span><span><span>&lt;</span>meta</span> <span>property</span><span><span>=</span><span>"</span>og:image<span>"</span></span> <span>content</span><span><span>=</span><span>{</span>post<span>.</span><span>ogImage</span><span>.</span><span>url</span><span>}</span></span> <span>/&gt;</span></span><span>
              </span><span><span><span>&lt;/</span><span>Head</span></span><span>&gt;</span></span><span>
              </span><span><span><span>&lt;</span><span>PostHeader</span></span>
                <span>title</span><span><span>=</span><span>{</span>post<span>.</span><span>title</span><span>}</span></span>
                <span>coverImage</span><span><span>=</span><span>{</span>post<span>.</span><span>coverImage</span><span>}</span></span>
                <span>date</span><span><span>=</span><span>{</span>post<span>.</span><span>date</span><span>}</span></span>
                <span>author</span><span><span>=</span><span>{</span>post<span>.</span><span>author</span><span>}</span></span>
              <span>/&gt;</span></span><span>
              </span><span><span><span>&lt;</span><span>PostBody</span></span> <span>content</span><span><span>=</span><span>{</span>post<span>.</span><span>content</span><span>}</span></span> <span>/&gt;</span></span><span>
            </span><span><span><span>&lt;/</span>article</span><span>&gt;</span></span><span>
          </span><span><span><span>&lt;/</span></span><span>&gt;</span></span>
        <span>)</span><span>}</span><span>
      </span><span><span><span>&lt;/</span><span>Container</span></span><span>&gt;</span></span><span>
    </span><span><span><span>&lt;/</span><span>Layout</span></span><span>&gt;</span></span>
  <span>)</span>
<span>}</span></pre></div><p>The compiler will parse this code, transform it into AST, manipulate that AST
into the correct functional form for browser JS, and generate the new code. And
here’s the compiled code for that function that gets shipped to the browser:</p>
<div><pre><span>function</span> <span>y</span><span>(</span><span>e</span><span>)</span> <span>{</span>
  <span>let</span> <span>{</span> <span>post</span><span>:</span> t<span>,</span> <span>morePosts</span><span>:</span> n<span>,</span> <span>preview</span><span>:</span> l <span>}</span> <span>=</span> e<span>,</span>
    c <span>=</span> <span>(</span><span>0</span><span>,</span> r<span>.</span><span>useRouter</span><span>)</span><span>(</span><span>)</span><span>;</span>
  <span>return</span> c<span>.</span><span>isFallback</span> <span>||</span> <span>(</span><span>null</span> <span>==</span> t <span>?</span> <span>void</span> <span>0</span> <span>:</span> t<span>.</span><span>slug</span><span>)</span>
    <span>?</span> <span>(</span><span>0</span><span>,</span> s<span>.</span><span>jsx</span><span>)</span><span>(</span>v<span>.</span><span>Z</span><span>,</span> <span>{</span>
      <span>preview</span><span>:</span> l<span>,</span>
      <span>children</span><span>:</span> <span>(</span><span>0</span><span>,</span> s<span>.</span><span>jsxs</span><span>)</span><span>(</span>a<span>.</span><span>Z</span><span>,</span> <span>{</span>
        <span>children</span><span>:</span> <span>[</span>
          <span>(</span><span>0</span><span>,</span> s<span>.</span><span>jsx</span><span>)</span><span>(</span>h<span>,</span> <span>{</span><span>}</span><span>)</span><span>,</span>
          c<span>.</span><span>isFallback</span>
            <span>?</span> <span>(</span><span>0</span><span>,</span> s<span>.</span><span>jsx</span><span>)</span><span>(</span>j<span>,</span> <span>{</span>
              <span>children</span><span>:</span> <span>"Loading…"</span><span>,</span>
            <span>}</span><span>)</span>
            <span>:</span> <span>(</span><span>0</span><span>,</span> s<span>.</span><span>jsx</span><span>)</span><span>(</span>s<span>.</span><span><span>Fragment</span></span><span>,</span> <span>{</span>
              <span>children</span><span>:</span> <span>(</span><span>0</span><span>,</span> s<span>.</span><span>jsxs</span><span>)</span><span>(</span><span>"article"</span><span>,</span> <span>{</span>
                <span>className</span><span>:</span> <span>"mb-32"</span><span>,</span>
                <span>children</span><span>:</span> <span>[</span>
                  <span>(</span><span>0</span><span>,</span> s<span>.</span><span>jsxs</span><span>)</span><span>(</span><span>N</span><span>(</span><span>)</span><span>,</span> <span>{</span>
                    <span>children</span><span>:</span> <span>[</span>
                      <span>(</span><span>0</span><span>,</span> s<span>.</span><span>jsxs</span><span>)</span><span>(</span><span>"title"</span><span>,</span> <span>{</span>
                        <span>children</span><span>:</span> <span>[</span>
                          t<span>.</span><span>title</span><span>,</span>
                          <span>" | Next.js Blog Example with "</span><span>,</span>
                          w<span>.</span><span>yf</span><span>,</span>
                        <span>]</span><span>,</span>
                      <span>}</span><span>)</span><span>,</span>
                      <span>(</span><span>0</span><span>,</span> s<span>.</span><span>jsx</span><span>)</span><span>(</span><span>"meta"</span><span>,</span> <span>{</span>
                        <span>property</span><span>:</span> <span>"og:image"</span><span>,</span>
                        <span>content</span><span>:</span> t<span>.</span><span>ogImage</span><span>.</span><span>url</span><span>,</span>
                      <span>}</span><span>)</span><span>,</span>
                    <span>]</span><span>,</span>
                  <span>}</span><span>)</span><span>,</span>
                  <span>(</span><span>0</span><span>,</span> s<span>.</span><span>jsx</span><span>)</span><span>(</span>p<span>,</span> <span>{</span>
                    <span>title</span><span>:</span> t<span>.</span><span>title</span><span>,</span>
                    <span>coverImage</span><span>:</span> t<span>.</span><span>coverImage</span><span>,</span>
                    <span>date</span><span>:</span> t<span>.</span><span>date</span><span>,</span>
                    <span>author</span><span>:</span> t<span>.</span><span>author</span><span>,</span>
                  <span>}</span><span>)</span><span>,</span>
                  <span>(</span><span>0</span><span>,</span> s<span>.</span><span>jsx</span><span>)</span><span>(</span>x<span>,</span> <span>{</span>
                    <span>content</span><span>:</span> t<span>.</span><span>content</span><span>,</span>
                  <span>}</span><span>)</span><span>,</span>
                <span>]</span><span>,</span>
              <span>}</span><span>)</span><span>,</span>
            <span>}</span><span>)</span><span>,</span>
        <span>]</span><span>,</span>
      <span>}</span><span>)</span><span>,</span>
    <span>}</span><span>)</span>
    <span>:</span> <span>(</span><span>0</span><span>,</span> s<span>.</span><span>jsx</span><span>)</span><span>(</span><span>i</span><span>(</span><span>)</span><span>,</span> <span>{</span>
      <span>statusCode</span><span>:</span> <span>404</span><span>,</span>
    <span>}</span><span>)</span><span>;</span>
<span>}</span></pre></div><h3>Minifying</h3><p>Of course, that code isn’t meant to be read by a human, it only needs to be
understood by a browser. The minifying step replaces function and component
names with single characters to ship fewer kilobytes to the browser, improving
performance for the end user.</p>
<p>The above is also the ‘prettified’ version. Here’s what it really looks like:</p>
<div><pre><span>function</span> <span>y</span><span>(</span><span>e</span><span>)</span> <span>{</span>
  <span>let</span> <span>{</span> <span>post</span><span>:</span> t<span>,</span> <span>morePosts</span><span>:</span> n<span>,</span> <span>preview</span><span>:</span> l <span>}</span> <span>=</span> e<span>,</span> c <span>=</span> <span>(</span><span>0</span><span>,</span> r<span>.</span><span>useRouter</span><span>)</span><span>(</span><span>)</span><span>;</span>
  <span>return</span> c<span>.</span><span>isFallback</span> <span>||</span> <span>(</span><span>null</span> <span>==</span> t <span>?</span> <span>void</span> <span>0</span> <span>:</span> t<span>.</span><span>slug</span><span>)</span>
    <span>?</span> <span>(</span><span>0</span><span>,</span> s<span>.</span><span>jsx</span><span>)</span><span>(</span>v<span>.</span><span>Z</span><span>,</span> <span>{</span>
      <span>preview</span><span>:</span> l<span>,</span>
      <span>children</span><span>:</span> <span>(</span><span>0</span><span>,</span> s<span>.</span><span>jsxs</span><span>)</span><span>(</span>a<span>.</span><span>Z</span><span>,</span> <span>{</span>
        <span>children</span><span>:</span> <span>[</span>
          <span>(</span><span>0</span><span>,</span> s<span>.</span><span>jsx</span><span>)</span><span>(</span>h<span>,</span> <span>{</span><span>}</span><span>)</span><span>,</span>
          c<span>.</span><span>isFallback</span>
            <span>?</span> <span>(</span><span>0</span><span>,</span> s<span>.</span><span>jsx</span><span>)</span><span>(</span>j<span>,</span> <span>{</span> <span>children</span><span>:</span> <span>"Loading…"</span> <span>}</span><span>)</span>
            <span>:</span> <span>(</span><span>0</span><span>,</span> s<span>.</span><span>jsx</span><span>)</span><span>(</span>s<span>.</span><span><span>Fragment</span></span><span>,</span> <span>{</span>
              <span>children</span><span>:</span> <span>(</span><span>0</span><span>,</span> s<span>.</span><span>jsxs</span><span>)</span><span>(</span><span>"article"</span><span>,</span> <span>{</span>
                <span>className</span><span>:</span> <span>"mb-32"</span><span>,</span>
                <span>children</span><span>:</span> <span>[</span>
                  <span>(</span><span>0</span><span>,</span> s<span>.</span><span>jsxs</span><span>)</span><span>(</span><span>N</span><span>(</span><span>)</span><span>,</span> <span>{</span>
                    <span>children</span><span>:</span> <span>[</span>
                      <span>(</span><span>0</span><span>,</span> s<span>.</span><span>jsxs</span><span>)</span><span>(</span><span>"title"</span><span>,</span> <span>{</span>
                        <span>children</span><span>:</span> <span>[</span>
                          t<span>.</span><span>title</span><span>,</span>
                          <span>" | Next.js Blog Example with "</span><span>,</span>
                          w<span>.</span><span>yf</span><span>,</span>
                        <span>]</span><span>,</span>
                      <span>}</span><span>)</span><span>,</span>
                      <span>(</span><span>0</span><span>,</span> s<span>.</span><span>jsx</span><span>)</span><span>(</span><span>"meta"</span><span>,</span> <span>{</span>
                        <span>property</span><span>:</span> <span>"og:image"</span><span>,</span>
                        <span>content</span><span>:</span> t<span>.</span><span>ogImage</span><span>.</span><span>url</span><span>,</span>
                      <span>}</span><span>)</span><span>,</span>
                    <span>]</span><span>,</span>
                  <span>}</span><span>)</span><span>,</span>
                  <span>(</span><span>0</span><span>,</span> s<span>.</span><span>jsx</span><span>)</span><span>(</span>p<span>,</span> <span>{</span>
                    <span>title</span><span>:</span> t<span>.</span><span>title</span><span>,</span>
                    <span>coverImage</span><span>:</span> t<span>.</span><span>coverImage</span><span>,</span>
                    <span>date</span><span>:</span> t<span>.</span><span>date</span><span>,</span>
                    <span>author</span><span>:</span> t<span>.</span><span>author</span><span>,</span>
                  <span>}</span><span>)</span><span>,</span>
                  <span>(</span><span>0</span><span>,</span> s<span>.</span><span>jsx</span><span>)</span><span>(</span>x<span>,</span> <span>{</span> <span>content</span><span>:</span> t<span>.</span><span>content</span> <span>}</span><span>)</span><span>,</span>
                <span>]</span><span>,</span>
              <span>}</span><span>)</span><span>,</span>
            <span>}</span><span>)</span><span>,</span>
        <span>]</span><span>,</span>
      <span>}</span><span>)</span><span>,</span>
    <span>}</span><span>)</span>
    <span>:</span> <span>(</span><span>0</span><span>,</span> s<span>.</span><span>jsx</span><span>)</span><span>(</span><span>i</span><span>(</span><span>)</span><span>,</span> <span>{</span> <span>statusCode</span><span>:</span> <span>404</span> <span>}</span><span>)</span><span>;</span>
<span>}</span></pre></div><h3>Bundling</h3><p>All the above code is contained in a file called (for this build)
<code>[slug]-af0d50a2e56018ac.js.</code> When that code is prettified, the file is 447
lines long. Compare that to the much smaller 56 lines of code from the original
<code>[slug].tsx</code> that we edit.</p>
<p>Why did we ship a 10X larger file?</p>
<p>Because of another critical part of the build process: bundling.</p>
<p>Despite <code>[slug].tsx</code> being only 56 lines long, it relies on many dependencies
and components, which in turn relies on more dependencies and components. All of
those modules need to be loaded for <code>[slug].tsx</code> to work properly.</p>
<p>Let’s use <a href="https://github.com/sverweij/dependency-cruiser" title="null" rel="noopener noreferrer">dependency cruiser</a>
to visualize this. First, we’ll just look at the components:</p>
<div><pre>npx depcruise <span>--exclude</span> <span>"^node_modules"</span> --output-type dot pages <span>|</span> dot <span>-T</span> svg <span>&gt;</span> dependencygraph.svg</pre></div><p>Here’s the dependency graph:</p>
<p><img alt="A depedency graph of a Next.js app" title=""></p>
<p>Not too bad. But each of these has node module dependencies. Let’s remove that
<code>--exclude "^node_modules"</code> to look at everything in this project:</p>
<div><pre>npx depcruise --output-type dot pages <span>|</span> dot <span>-T</span> svg <span>&gt;</span> dependencygraph.svg</pre></div><p>When we factor those in, the graph gets larger. Like, <em>huge</em>. It's so big that
to keep the image interesting, we annotated it as if it were a fun, medieval era
map. (Also,
<a rel="noopener noreferrer">this
is an svg</a> so feel free to open it in a new tab so you can zoom in and soak
in all the juicy details.)</p>
<p><img alt="A map of dependencies of a basic Next.js app" title=""></p>
<p>(<em>Who knew that so much went into
<a href="https://www.npmjs.com/package/date-fns" title="null" rel="noopener noreferrer"><code>date-fns</code></a>?</em>)</p>
<p>Bundlers require creating a dependency graph for an entry point into the code
(usually index.js), then work backwards looking for everything that <code>index.js</code>
depends on, then everything that <code>index.js</code> depends on depends on, and so on. It
then bundles all that into a single output file that can be shipped to the
browser.</p>
<p>For large projects, this is where the bulk of the build time is spent:
traversing and creating a dependency graph, then adding what's necessary to send
to the client in a single bundle.</p>
<h3>Code-splitting</h3><p>Or not, if you have code-splitting.</p>
<p>Without code-splitting, a single, bundled JS file would be shipped to the client
the first time a user touched the site, whether or not the entirety of that
JavaScript was needed. With code-splitting, a performance optimization step,
JavaScript is chunked by entry point (e.g. by page or by UI component) or by
dynamic imports (so only a small portion of the JavaScript has to be shipped at
any one time). Code-splitting helps "lazy load" things currently needed by the
user by loading only what is needed and avoiding code that may never be used.
With React, you can experience up to
<a href="https://www.iamtk.co/web-performance-code-splitting-strategies-and-react-applications" title="null" rel="noopener noreferrer">30% reduction in main bundle size when using code splitting</a>.</p>
<p>In our example, <code>[slug]-af0d50a2e56018ac.js</code> is the code needed to load a
specific blog post page, and it does not include any code for the home page or
any other component on the site.</p>
<p>You can start to see why there is a proliferation of build systems and tools in
the ecosystem: this shit is complicated. We haven’t even got into all the
options you have to configure and compile CSS. Webpack tutorials on YouTube are
<a href="https://www.youtube.com/watch?v=MpGLUVbqoYQ" title="null" rel="noopener noreferrer">literally hours long</a>. Long build
times are a common frustration, so much so that a main theme of the
<a href="https://nextjs.org/blog/next-13#introducing-turbopack-alpha" title="null" rel="noopener noreferrer">recent Next.js 13 update was faster building</a>.</p>
<p>As the JavaScript community worked on improving the developer experience in
building apps (metaframeworks, CSS preprocessors, JSX, etc.), it also had to
work on building better tools and task runners to make the build step less
painful.</p>
<p>What if there is another approach?</p>
<h2>Non-building with Deno and Fresh</h2><blockquote>
<p>I find Deno similar: if you learn server-side JavaScript with Deno, you might
accidentally learn the web platform along the way. It’s transferable
knowledge.</p>
<p>— Jim Nielsen,
<a href="https://blog.jim-nielsen.com/2022/deno-is-webby-pt-2/" title="null" rel="noopener noreferrer">Deno is Webby (pt. 2)</a></p>
</blockquote>
<p>The build steps above all stem from a simple problem—Node's JavaScript has
diverged from that of the browser. But what if we could write browser compatible
JavaScript that uses web APIs like <code>fetch</code> and native ESM imports, from the get
go?</p>
<p>That’s Deno. Deno takes the approach that web JS has improved massively in
recent years and is now an extremely powerful scripting language. We should all
be using it.</p>
<p>Here’s how you might do the same thing as above,
<a href="https://deno.com/blog/build-a-blog-with-fresh" title="null" rel="noopener noreferrer">build a blog</a>, but with Deno and
<a href="https://fresh.deno.dev" title="null" rel="noopener noreferrer">Fresh</a>.</p>
<p>Fresh is a web framework built on Deno that does not have a build step — no
bundling, no transpiling — and that is by design. When a request comes into the
server, Fresh renders each page on the fly and sends only HTML (unless an Island
is involved, then only the needed amount of JavaScript will be sent as well).</p>
<h3>Just-in-time builds over bundling</h3><p>The lack of bundling comes into the first part of this: just-in-time builds.
Rendering a page with Fresh is like loading a plain web page. Because all
imports are URLs, the page you load calls the URLs to load the other code it
needs (either from source, or from a cache if it’s been previously used).</p>
<p>With Fresh, when a user clicks on a post page, <code>/routes/[slug].tsx</code> is loaded.
This page imports these modules:</p>
<div><pre><span>import</span> <span><span>{</span> <span>Handlers</span><span>,</span> <span>PageProps</span> <span>}</span></span> <span>from</span> <span>"$fresh/server.ts"</span><span>;</span>
<span>import</span> <span><span>{</span> <span>Head</span> <span>}</span></span> <span>from</span> <span>"$fresh/runtime.ts"</span><span>;</span>
<span>import</span> <span><span>{</span> getPost<span>,</span> <span>Post</span> <span>}</span></span> <span>from</span> <span>"@/utils/posts.ts"</span><span>;</span>
<span>import</span> <span>{</span> <span>CSS</span><span>,</span> render <span>}</span> <span>from</span> <span>"$gfm"</span><span>;</span></pre></div><p>This may look a lot like importing anything in Node. But that’s because we’re
using specifiers from our
<a href="https://github.com/denoland/fresh-blog-example/blob/main/import_map.json" title="null" rel="noopener noreferrer">import map</a>.
When resolved these imports are:</p>
<div><pre><span>import</span> <span><span>{</span> <span>Handlers</span><span>,</span> <span>PageProps</span> <span>}</span></span> <span>from</span> <span>"https://deno.land/x/fresh@1.1.0/server.ts"</span><span>;</span>
<span>import</span> <span><span>{</span> <span>Head</span> <span>}</span></span> <span>from</span> <span>"https://deno.land/x/fresh@1.1.0/runtime.ts"</span><span>;</span>
<span>import</span> <span><span>{</span> getPost<span>,</span> <span>Post</span> <span>}</span></span> <span>from</span> <span>"../utils/posts.ts"</span><span>;</span>
<span>import</span> <span>{</span> <span>CSS</span><span>,</span> render <span>}</span> <span>from</span> <span>"https://deno.land/x/gfm@0.1.26/mod.ts"</span><span>;</span></pre></div><p>We’re importing <code>getPost</code> and <code>Post</code> from our own module
<a href="https://github.com/denoland/fresh-blog-example/blob/main/utils/posts.ts" title="null" rel="noopener noreferrer">posts.ts</a>.
In those components, we’re
<a href="https://deno.land/manual/basics/modules#remote-import" title="null" rel="noopener noreferrer">importing modules from other URLs</a>:</p>
<div><pre><span>import</span> <span><span>{</span> extract <span>}</span></span> <span>from</span> <span>"https://deno.land/std@0.160.0/encoding/front_matter.ts"</span><span>;</span>
<span>import</span> <span><span>{</span> join <span>}</span></span> <span>from</span> <span>"https://deno.land/std@0.160.0/path/posix.ts"</span><span>;</span></pre></div><p>At any given point in the dependency graph, we’re just calling code from other
URLs. Like turtles, it’s URLs all the way down.</p>
<h3>Just-in-time transpiling</h3><p>Fresh doesn't require any separate transpile steps either, since it all happens
just-in-time on request:</p>
<ul>
<li>Making TypeScript and TSX work in the browser: the Deno runtime transpiles
TypeScript and TSX out-of-the-box just-in-time on request.</li>
<li>Server-side rendering: passing dynamic data through a template to generate
HTML also happens on request.</li>
<li>Writing client-side TypeScript via islands: client-side TypeScript is
transpiled to JavaScript on-demand, which is necessary because browsers do not
understand TypeScript</li>
</ul>
<p>And to be make your Fresh app more performant, all client-side
JavaScript/TypeScript is cached after the first request for fast subsequent
retrievals.</p>
<h2>Better code, faster</h2><p>As long as developers are not writing raw HTML, JS, and CSS, and need to
optimize assets for the performance of the end user, there will inevitably be
some sort of "build" step. Whether that step is a separate step that takes
minutes and happens in CI/CD or just-in-time when the request happens, depends
on your framework or stack of choice.</p>
<p>But removing the build step means you can move faster and be more productive.
Stay in flow for longer. No more sword fighting breaks (sorry) or context
switching when making a change to your code.</p>
<p>You can also deploy faster. Since there's no build step, especially when using
<a title="null" rel="noopener noreferrer">Deno Deploy's</a> <a title="null" rel="noopener noreferrer">v8 isolate cloud</a>, your
deployment globally takes seconds since it's simply uploading a few kb's of
JavaScript.</p>
<p>You're also writing better code, with a better developer experience. Instead of
learning Node or vendor specific APIs while trying to tie Node, ESM, and browser
compliant JavaScript through a web of bundlers, you can write web standard
JavaScript, learning APIs that you can re-use with any cloud primitives.</p>
<p><em>Skip the build step and try making something with
<a href="https://fresh.deno.dev" title="null" rel="noopener noreferrer">Fresh</a> and <a href="https://deno.com/deploy" title="null" rel="noopener noreferrer">Deno Deploy</a>.</em></p>
</div>